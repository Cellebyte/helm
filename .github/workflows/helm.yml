name: CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Install Helm 3
      uses: Azure/setup-helm@v1
      with:
        version: v3.1.0
    - name: Lint Helm Charts
      run: helm lint charts/*
    - name: Pull in all dependencies
      run: helm dependency build charts/*
    - name: Package all Helm Charts
      run: helm package charts/*
    - name: Create new repoIndex
      run: helm repo index --url https://cellebyte.github.io/helm/ .
    - name: Helm Publish
      uses: mikeal/publish-to-github-action@master
      env:
        GITHUB_TOKEN:  ${{ secrets.ACCESS_TOKEN }}
